{% extends "layout.html" %}

{% block body %}
<section id="error">
    <div class="container">
        <div class="row">
            <div class="col-md text-center">
                <p class="lead">{{ message }}</p>
            </div>
        </div>
    </div>
</section>
<section id="section1">
<div class="container mt-4">
    <div class="row">
        <div class="col-md border border-primary rounded p-1 m-1">
            <form autocomplete="off" action="/" method="post">
                <div class="row">     
                    <div class="col">
                        <h1 class="display-6 text-primary">Institutions</h1>
                        <div class="mb-3 position-relative autocomplete">
                            <label for="inst1" class="form-label">First Institution</label>
                            <input type="text" id="inst1_name" name="inst1_name" class="form-control" placeholder="Start typing an institution name">
                            <input type="hidden" id="inst1_id" name="inst1_id">

                        </div>
                        <div class="mb-3 position-relative autocomplete">
                            <label for="inst2" class="form-label">Second Institution</label>
                            <input type="search" id="inst2_name" name="inst2_name" class="form-control" placeholder="Start typing an institution name">
                            <input type="hidden" id="inst2_id" name="inst2_id">
                        </div>
                    </div>
                    <div class="col">
                        <h1 class="display-6 text-primary">Select themes to compare</h1>
                            <div class="mb-3 position-relative form-check">
                                <input class="form-check-input" onClick="checkAll(this)" type="checkbox" id="All" name="All" value="All">
                                <label class="form-check-label">Select All</label>
                            </div>
                            <div class="position-relative form-check">
                                <input class="form-check-input" type="checkbox" id="1" name="themes[]" value="1">
                                <label class="form-check-label">Theme 1: Teaching on my course</label>
                            </div>
                            <div class="position-relative form-check">
                                <input class="form-check-input" type="checkbox" id="2" name="themes[]" value="2">
                                <label class="form-check-label">Theme 2: Learning opportunities</label>
                            </div>
                            <div class="position-relative form-check">
                                <input class="form-check-input" type="checkbox" id="3" name="themes[]" value="3">
                                <label class="form-check-label">Theme 3: Assessment and feedback</label>
                            </div>
                            <div class="position-relative form-check">
                                <input class="form-check-input" type="checkbox" id="4" name="themes[]" value="4">
                                <label class="form-check-label">Theme 4: Academic support</label>
                            </div>
                            <div class="position-relative form-check">
                                <input class="form-check-input" type="checkbox" id="5" name="themes[]" value="5">
                                <label class="form-check-label">Theme 5: Organisation and management</label>
                            </div>
                            <div class="position-relative form-check">
                                <input class="form-check-input" type="checkbox" id="6" name="themes[]" value="6">
                                <label class="form-check-label">Theme 6: Learning resources</label>
                            </div>
                            <div class="mb-3 position-relative form-check">
                                <input class="form-check-input" type="checkbox" id="7" name="themes[]" value="7">
                                <label class="form-check-label">Theme 7: Student voice</label>
                            </div>
                    </div>
                </div>
            <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>
</div>
</section>

<script>
function setupAutocomplete(nameInputId, hiddenIdInputId) {
    const nameInput = document.getElementById(nameInputId);
    const hiddenInput = document.getElementById(hiddenIdInputId);

    const dropdown = document.createElement("div");
    dropdown.classList.add("autocomplete-items", "list-group");
    nameInput.parentNode.appendChild(dropdown);

    nameInput.addEventListener("input", async function () {
        const query = this.value.trim();
        dropdown.innerHTML = "";
        hiddenInput.value = "";  // clear previous selection

        if (query.length < 2) return;

        const res = await fetch(`/autocomplete?q=${encodeURIComponent(query)}`);
        const items = await res.json();

        items.forEach(item => {
            const option = document.createElement("div");
            option.textContent = item.name;
            option.classList.add("autocomplete-item", "list-group-item", "list-group-item-action");

            option.addEventListener("click", () => {
                nameInput.value = item.name;
                hiddenInput.value = item.ukprn;
                dropdown.innerHTML = "";
            });

            dropdown.appendChild(option);
        });
    });
}

document.addEventListener("DOMContentLoaded", () => {
    setupAutocomplete("inst1_name", "inst1_id");
    setupAutocomplete("inst2_name", "inst2_id");
});

function checkAll(source) {
    checkboxes = document.getElementsByClassName('form-check-input');
    for(var i=0, n=checkboxes.length;i<n;i++) {
        checkboxes[i].checked = source.checked;
    }
}
</script>


{% endblock %}